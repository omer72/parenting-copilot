import type { AIResponse } from '../types';

interface ResponseTemplate {
  keywords: string[];
  ageRange?: [number, number];
  responses: AIResponse[];
}

export const responseTemplates: ResponseTemplate[] = [
  {
    keywords: ['התקף זעם', 'זעם', 'צורח', 'צועק', 'היסטריה'],
    responses: [
      {
        doNow: 'רד לגובה העיניים של הילד, נשום עמוק והישאר רגוע. הנוכחות השקטה שלך מרגיעה יותר מכל מילה.',
        dontDo: 'אל תצעק בחזרה ואל תנסה להסביר עכשיו. הילד במצב רגשי ולא יכול לקלוט הסברים.',
        sayThis: 'אני רואה שאתה מאוד כועס עכשיו. אני כאן איתך.',
      },
      {
        doNow: 'הבטח שהילד במקום בטוח, והישאר קרוב בלי להתערב ישירות. תן להתקף לעבור.',
        dontDo: 'אל תנסה לעצור את הבכי בכוח או להסיח את הדעת מיד. זה מונע עיבוד רגשי.',
        sayThis: 'כשתהיה מוכן, אני כאן לחיבוק.',
      },
    ],
  },
  {
    keywords: ['לא רוצה', 'מסרב', 'סירוב', 'לא אכפת', 'עקשן'],
    responses: [
      {
        doNow: 'הצע שתי אפשרויות מקובלות עליך. תחושת בחירה מפחיתה התנגדות.',
        dontDo: 'אל תיכנס למאבק כוחות או תאיים. זה רק מגביר את ההתנגדות.',
        sayThis: 'אתה מעדיף קודם X או Y?',
      },
      {
        doNow: 'הכר ברצון שלו גם אם אתה לא יכול למלא אותו. הקשבה מפחיתה מאבקים.',
        dontDo: 'אל תתעלם או תבטל את הרצון שלו. גם אם התשובה היא לא, הוא צריך להרגיש שנשמע.',
        sayThis: 'אני מבין שאתה רוצה... עכשיו אנחנו צריכים... בואו נמצא פתרון ביחד.',
      },
    ],
  },
  {
    keywords: ['מכה', 'בועט', 'אלימות', 'אלים', 'פוגע'],
    responses: [
      {
        doNow: 'עצור את הפעולה הפיזית בעדינות אך בתקיפות. הגבול חייב להיות ברור ומיידי.',
        dontDo: 'אל תכה בחזרה ואל תצעק. תגובה אלימה מלמדת שאלימות היא פתרון.',
        sayThis: 'אני לא אתן לך להכות. הכאה כואבת. אני כאן לעזור לך להירגע.',
      },
    ],
  },
  {
    keywords: ['פחד', 'מפחד', 'פוחד', 'חושך', 'לבד'],
    responses: [
      {
        doNow: 'קבל את הפחד בלי לנסות לשכנע שאין סיבה לפחד. תן נוכחות מרגיעה.',
        dontDo: 'אל תגיד "אין ממה לפחד" - זה מבטל את הרגש שלו ולא עוזר.',
        sayThis: 'אני מבין שזה מפחיד אותך. אני כאן איתך ואני אשמור עליך.',
      },
    ],
  },
  {
    keywords: ['שיעורים', 'שיעורי בית', 'לימודים', 'בית ספר'],
    responses: [
      {
        doNow: 'שב לידו ותן לו להוביל. שאל איפה הוא תקוע במקום להסביר מיד.',
        dontDo: 'אל תעשה את השיעורים במקומו ואל תלחץ יותר מדי. זה פוגע במוטיבציה.',
        sayThis: 'בוא נסתכל על זה ביחד. מה הכי קשה כאן?',
      },
    ],
  },
  {
    keywords: ['אוכל', 'לא אוכל', 'לא רעב', 'ארוחה'],
    responses: [
      {
        doNow: 'הצע את האוכל בלי לחץ והמשך בארוחה שלך. ילדים מרגישים לחץ ומסרבים יותר.',
        dontDo: 'אל תכריח לאכול ואל תשתמש בקינוח כפרס. זה יוצר יחס בעייתי לאוכל.',
        sayThis: 'האוכל כאן כשתהיה מוכן. הגוף שלך יודע מתי הוא רעב.',
      },
    ],
  },
  {
    keywords: ['שינה', 'לא רוצה לישון', 'לישון', 'עייף'],
    responses: [
      {
        doNow: 'צור שגרת הרגעה קבועה: אמבטיה, ספר, שיר. צפיות ברורות מקלות את המעבר.',
        dontDo: 'אל תאפשר מסכים שעה לפני השינה. האור הכחול מפריע להירדמות.',
        sayThis: 'הגוף שלך עייף ומבקש מנוחה. בוא נתכונן לשינה ביחד.',
      },
    ],
  },
  {
    keywords: ['ריב', 'אחים', 'אחיות', 'מתקוטטים', 'שלו'],
    responses: [
      {
        doNow: 'הפרד בין הילדים אם צריך, אבל אל תחפש אשם. תן לכל אחד לספר את הצד שלו.',
        dontDo: 'אל תשווה ביניהם ואל תגיד "למה אתה לא יכול להיות כמו..." - זה מגביר תחרות.',
        sayThis: 'אני רואה ששניכם מתוסכלים. בואו נמצא פתרון שעובד לכולם.',
      },
    ],
  },
];

export const defaultResponses: AIResponse[] = [
  {
    doNow: 'עצור, נשום, והתבונן במה שקורה. לפעמים רגע של שקט עוזר יותר מכל פעולה.',
    dontDo: 'אל תגיב מתוך כעס או תסכול. תגובה רגשית מעבירה מסר לא רצוי.',
    sayThis: 'אני רואה שמשהו קשה לך עכשיו. ספר לי.',
  },
  {
    doNow: 'התחבר לילד ברמה הרגשית לפני שמנסה לפתור את הבעיה.',
    dontDo: 'אל תקפוץ מיד לפתרונות לפני שהילד מרגיש שמעת אותו.',
    sayThis: 'אני מבין שזה מרגיש קשה. אני כאן איתך.',
  },
];

export function generateClarificationQuestions(
  description: string,
  context: { location: string; presence: string }
): string[] {
  const questions: string[] = [];

  if (description.length < 30) {
    questions.push('אפשר לספר עוד קצת על מה שקרה?');
  }

  if (context.presence === 'public' || context.presence === 'strangers') {
    questions.push('האם יש לחץ חיצוני מהסביבה?');
  }

  if (description.includes('פעם ראשונה') || description.includes('חדש')) {
    questions.push('האם זה קורה לעתים קרובות או זו פעם ראשונה?');
  }

  return questions.slice(0, 3);
}
